# C语言结构体

本教程将学习C语言中的结构体（struct），用于组织相关数据。

## 1. 结构体基础

### 结构体定义和声明

```c
#include <stdio.h>
#include <string.h>

// 定义结构体
struct Student {
    int id;
    char name[50];
    int age;
    float score;
};

int main() {
    // 声明结构体变量
    struct Student s1;
    
    // 初始化结构体成员
    s1.id = 1;
    strcpy(s1.name, "张三");
    s1.age = 20;
    s1.score = 85.5f;
    
    // 访问结构体成员
    printf("学号: %d\n", s1.id);
    printf("姓名: %s\n", s1.name);
    printf("年龄: %d\n", s1.age);
    printf("成绩: %.2f\n", s1.score);
    
    return 0;
}
```

### 结构体初始化

```c
#include <stdio.h>
#include <string.h>

struct Point {
    int x;
    int y;
};

struct Person {
    char name[50];
    int age;
};

int main() {
    // 初始化时赋值
    struct Point p1 = {10, 20};
    printf("点: (%d, %d)\n", p1.x, p1.y);
    
    // 指定成员初始化（C99标准）
    struct Point p2 = {.y = 30, .x = 15};
    printf("点: (%d, %d)\n", p2.x, p2.y);
    
    // 结构体变量赋值
    struct Person person1 = {"李四", 25};
    printf("姓名: %s, 年龄: %d\n", person1.name, person1.age);
    
    return 0;
}
```

## 2. 结构体数组

```c
#include <stdio.h>
#include <string.h>

struct Student {
    int id;
    char name[50];
    int age;
    float score;
};

int main() {
    // 结构体数组
    struct Student students[3] = {
        {1, "张三", 20, 85.5f},
        {2, "李四", 21, 90.0f},
        {3, "王五", 20, 78.5f}
    };
    
    printf("学生信息:\n");
    for (int i = 0; i < 3; i++) {
        printf("学号: %d, 姓名: %s, 年龄: %d, 成绩: %.2f\n",
               students[i].id, students[i].name,
               students[i].age, students[i].score);
    }
    
    // 计算平均成绩
    float sum = 0;
    for (int i = 0; i < 3; i++) {
        sum += students[i].score;
    }
    printf("平均成绩: %.2f\n", sum / 3);
    
    return 0;
}
```

## 3. 结构体指针

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

struct Student {
    int id;
    char name[50];
    int age;
    float score;
};

int main() {
    struct Student s1 = {1, "张三", 20, 85.5f};
    struct Student *ptr = &s1;  // 结构体指针
    
    // 通过指针访问成员（使用 -> 运算符）
    printf("学号: %d\n", ptr->id);
    printf("姓名: %s\n", ptr->name);
    printf("年龄: %d\n", ptr->age);
    printf("成绩: %.2f\n", ptr->score);
    
    // 等价于 (*ptr).id
    printf("学号: %d\n", (*ptr).id);
    
    // 动态分配结构体
    struct Student *s2 = (struct Student *)malloc(sizeof(struct Student));
    s2->id = 2;
    strcpy(s2->name, "李四");
    s2->age = 21;
    s2->score = 90.0f;
    
    printf("\n动态分配的结构体:\n");
    printf("学号: %d, 姓名: %s\n", s2->id, s2->name);
    
    free(s2);
    
    return 0;
}
```

## 4. 结构体作为函数参数

```c
#include <stdio.h>
#include <string.h>

struct Student {
    int id;
    char name[50];
    int age;
    float score;
};

// 值传递
void print_student(struct Student s) {
    printf("学号: %d\n", s.id);
    printf("姓名: %s\n", s.name);
    printf("年龄: %d\n", s.age);
    printf("成绩: %.2f\n", s.score);
}

// 指针传递（更高效）
void print_student_ptr(struct Student *s) {
    printf("学号: %d\n", s->id);
    printf("姓名: %s\n", s->name);
    printf("年龄: %d\n", s->age);
    printf("成绩: %.2f\n", s->score);
}

// 通过指针修改结构体
void update_score(struct Student *s, float new_score) {
    s->score = new_score;
}

int main() {
    struct Student s1 = {1, "张三", 20, 85.5f};
    
    printf("值传递:\n");
    print_student(s1);
    
    printf("\n指针传递:\n");
    print_student_ptr(&s1);
    
    printf("\n修改成绩后:\n");
    update_score(&s1, 95.0f);
    print_student_ptr(&s1);
    
    return 0;
}
```

## 5. 嵌套结构体

```c
#include <stdio.h>
#include <string.h>

struct Date {
    int year;
    int month;
    int day;
};

struct Student {
    int id;
    char name[50];
    struct Date birthday;  // 嵌套结构体
    float score;
};

int main() {
    struct Student s1 = {
        .id = 1,
        .name = "张三",
        .birthday = {2000, 5, 15},
        .score = 85.5f
    };
    
    printf("学号: %d\n", s1.id);
    printf("姓名: %s\n", s1.name);
    printf("生日: %d年%d月%d日\n", 
           s1.birthday.year, s1.birthday.month, s1.birthday.day);
    printf("成绩: %.2f\n", s1.score);
    
    return 0;
}
```

## 6. 结构体中的数组和指针

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

// 结构体中包含数组
struct Student {
    int id;
    char name[50];
    int scores[3];  // 三门课成绩
};

// 结构体中包含指针
struct Employee {
    int id;
    char *name;  // 动态字符串
    float salary;
};

int main() {
    // 结构体中的数组
    struct Student s1 = {1, "张三", {85, 90, 88}};
    printf("学生: %s\n", s1.name);
    printf("成绩: ");
    for (int i = 0; i < 3; i++) {
        printf("%d ", s1.scores[i]);
    }
    printf("\n");
    
    // 结构体中的指针
    struct Employee e1;
    e1.id = 1001;
    e1.name = (char *)malloc(50 * sizeof(char));
    strcpy(e1.name, "李四");
    e1.salary = 8000.0f;
    
    printf("\n员工: %s\n", e1.name);
    printf("工资: %.2f\n", e1.salary);
    
    free(e1.name);
    
    return 0;
}
```

## 7. typedef 简化结构体

```c
#include <stdio.h>
#include <string.h>

// 使用typedef简化结构体声明
typedef struct {
    int x;
    int y;
} Point;

typedef struct {
    char name[50];
    int age;
    Point location;  // 使用Point类型
} Person;

int main() {
    // 不需要写struct关键字
    Point p1 = {10, 20};
    printf("点: (%d, %d)\n", p1.x, p1.y);
    
    Person person1 = {"张三", 25, {5, 10}};
    printf("姓名: %s\n", person1.name);
    printf("位置: (%d, %d)\n", person1.location.x, person1.location.y);
    
    return 0;
}
```

## 8. 联合体（Union）

```c
#include <stdio.h>

// 联合体：所有成员共享同一块内存
union Data {
    int i;
    float f;
    char str[20];
};

int main() {
    union Data data;
    
    data.i = 10;
    printf("data.i = %d\n", data.i);
    
    data.f = 3.14f;
    printf("data.f = %.2f\n", data.f);
    // 注意：此时data.i的值已改变
    
    strcpy(data.str, "Hello");
    printf("data.str = %s\n", data.str);
    
    // 联合体的大小等于最大成员的大小
    printf("联合体大小: %lu 字节\n", sizeof(union Data));
    
    return 0;
}
```

## 9. 枚举（Enum）

```c
#include <stdio.h>

// 枚举类型
enum Weekday {
    MONDAY = 1,
    TUESDAY,
    WEDNESDAY,
    THURSDAY,
    FRIDAY,
    SATURDAY,
    SUNDAY
};

// 使用typedef简化
typedef enum {
    RED,
    GREEN,
    BLUE
} Color;

int main() {
    enum Weekday today = WEDNESDAY;
    printf("今天是星期 %d\n", today);
    
    Color color = GREEN;
    printf("颜色代码: %d\n", color);
    
    return 0;
}
```

## 10. 综合示例

### 示例1：学生管理系统

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX_STUDENTS 100

typedef struct {
    int id;
    char name[50];
    int age;
    float score;
} Student;

void add_student(Student students[], int *count) {
    if (*count >= MAX_STUDENTS) {
        printf("学生数量已达上限\n");
        return;
    }
    
    printf("请输入学号: ");
    scanf("%d", &students[*count].id);
    printf("请输入姓名: ");
    scanf("%s", students[*count].name);
    printf("请输入年龄: ");
    scanf("%d", &students[*count].age);
    printf("请输入成绩: ");
    scanf("%f", &students[*count].score);
    
    (*count)++;
    printf("添加成功\n");
}

void print_all_students(Student students[], int count) {
    if (count == 0) {
        printf("暂无学生信息\n");
        return;
    }
    
    printf("\n所有学生信息:\n");
    printf("%-5s %-15s %-5s %-5s\n", "学号", "姓名", "年龄", "成绩");
    for (int i = 0; i < count; i++) {
        printf("%-5d %-15s %-5d %-5.2f\n",
               students[i].id, students[i].name,
               students[i].age, students[i].score);
    }
}

int main() {
    Student students[MAX_STUDENTS];
    int count = 0;
    int choice;
    
    do {
        printf("\n=== 学生管理系统 ===\n");
        printf("1. 添加学生\n");
        printf("2. 查看所有学生\n");
        printf("0. 退出\n");
        printf("请选择: ");
        scanf("%d", &choice);
        
        switch (choice) {
            case 1:
                add_student(students, &count);
                break;
            case 2:
                print_all_students(students, count);
                break;
            case 0:
                printf("再见！\n");
                break;
            default:
                printf("无效选择\n");
        }
    } while (choice != 0);
    
    return 0;
}
```

### 示例2：链表实现

```c
#include <stdio.h>
#include <stdlib.h>

typedef struct Node {
    int data;
    struct Node *next;
} Node;

// 在链表末尾添加节点
void append(Node **head, int data) {
    Node *new_node = (Node *)malloc(sizeof(Node));
    new_node->data = data;
    new_node->next = NULL;
    
    if (*head == NULL) {
        *head = new_node;
        return;
    }
    
    Node *current = *head;
    while (current->next != NULL) {
        current = current->next;
    }
    current->next = new_node;
}

// 打印链表
void print_list(Node *head) {
    Node *current = head;
    while (current != NULL) {
        printf("%d -> ", current->data);
        current = current->next;
    }
    printf("NULL\n");
}

int main() {
    Node *head = NULL;
    
    append(&head, 10);
    append(&head, 20);
    append(&head, 30);
    
    print_list(head);
    
    // 释放内存（简化版，实际应该遍历释放）
    
    return 0;
}
```

## 练习

1. 定义一个表示图书的结构体（书名、作者、价格、出版年份），实现添加和查询功能
2. 使用结构体表示复数，实现复数的加法和乘法运算
3. 实现一个简单的联系人管理系统，使用链表存储联系人信息
4. 使用结构体和指针实现一个栈（Stack）数据结构

