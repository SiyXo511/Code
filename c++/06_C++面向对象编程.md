# C++面向对象编程

本教程将学习C++中的面向对象编程，包括类和对象、构造函数、析构函数、访问控制等。

## 1. 类和对象

### 基本类定义

```cpp
#include <iostream>
#include <string>
using namespace std;

// 类定义
class Person {
public:
    // 成员变量（属性）
    string name;
    int age;
    
    // 成员函数（方法）
    void introduce() {
        cout << "我是 " << name << "，今年 " << age << " 岁" << endl;
    }
    
    void setAge(int newAge) {
        if (newAge > 0) {
            age = newAge;
        }
    }
};

int main() {
    // 创建对象
    Person person1;
    person1.name = "张三";
    person1.age = 25;
    person1.introduce();
    
    // 创建另一个对象
    Person person2;
    person2.name = "李四";
    person2.age = 30;
    person2.introduce();
    
    return 0;
}
```

### 访问控制

```cpp
#include <iostream>
#include <string>
using namespace std;

class BankAccount {
private:
    // 私有成员：只能在类内部访问
    double balance;
    string accountNumber;
    
public:
    // 公有成员：可以在类外部访问
    string ownerName;
    
    // 公共接口
    void deposit(double amount) {
        if (amount > 0) {
            balance += amount;
        }
    }
    
    void withdraw(double amount) {
        if (amount > 0 && amount <= balance) {
            balance -= amount;
        }
    }
    
    double getBalance() {
        return balance;
    }
    
protected:
    // 保护成员：可以在派生类中访问
    string accountType;
};

int main() {
    BankAccount account;
    account.ownerName = "张三";
    // account.balance = 1000;  // 错误：不能直接访问私有成员
    // account.accountNumber = "12345";  // 错误：不能直接访问私有成员
    
    account.deposit(1000);
    account.withdraw(200);
    cout << "余额: " << account.getBalance() << endl;
    
    return 0;
}
```

## 2. 构造函数和析构函数

### 构造函数

```cpp
#include <iostream>
#include <string>
using namespace std;

class Student {
private:
    string name;
    int age;
    int score;
    
public:
    // 默认构造函数
    Student() {
        name = "未知";
        age = 0;
        score = 0;
        cout << "默认构造函数被调用" << endl;
    }
    
    // 带参数的构造函数
    Student(string n, int a, int s) {
        name = n;
        age = a;
        score = s;
        cout << "构造函数被调用: " << name << endl;
    }
    
    // 委托构造函数（C++11）
    Student(string n) : Student(n, 0, 0) {}
    
    // 拷贝构造函数
    Student(const Student& other) {
        name = other.name;
        age = other.age;
        score = other.score;
        cout << "拷贝构造函数被调用" << endl;
    }
    
    // 析构函数
    ~Student() {
        cout << "析构函数被调用: " << name << endl;
    }
    
    void display() {
        cout << "姓名: " << name << ", 年龄: " << age 
             << ", 分数: " << score << endl;
    }
};

int main() {
    Student s1;  // 调用默认构造函数
    Student s2("李四", 20, 90);  // 调用带参数的构造函数
    Student s3("王五");  // 调用委托构造函数
    Student s4(s2);  // 调用拷贝构造函数
    
    s2.display();
    s4.display();
    
    return 0;  // 析构函数会自动调用
}
```

### 初始化列表

```cpp
#include <iostream>
#include <string>
using namespace std;

class Point {
private:
    int x, y;
    const int id;  // 常量成员
    int& ref;      // 引用成员
    
public:
    // 使用初始化列表（必须用于const成员和引用成员）
    Point(int x_val, int y_val, int id_val, int& ref_val) 
        : x(x_val), y(y_val), id(id_val), ref(ref_val) {
        // 构造函数体
    }
    
    // 更好的方式：使用初始化列表初始化所有成员
    Point(int x_val, int y_val) : x(x_val), y(y_val), id(0), ref(x) {
        // 初始化列表比在构造函数体中赋值更高效
    }
    
    void display() {
        cout << "Point(" << x << ", " << y << ")" << endl;
    }
};

int main() {
    int value = 100;
    Point p1(10, 20, 1, value);
    Point p2(30, 40);
    
    p1.display();
    p2.display();
    
    return 0;
}
```

## 3. this指针

```cpp
#include <iostream>
#include <string>
using namespace std;

class Rectangle {
private:
    int width, height;
    
public:
    Rectangle(int width, int height) {
        // 使用this指针区分成员变量和参数
        this->width = width;
        this->height = height;
    }
    
    // 返回this指针，支持链式调用
    Rectangle& setWidth(int w) {
        width = w;
        return *this;
    }
    
    Rectangle& setHeight(int h) {
        height = h;
        return *this;
    }
    
    int area() {
        return width * height;
    }
    
    void display() {
        cout << "宽度: " << width << ", 高度: " << height 
             << ", 面积: " << area() << endl;
    }
};

int main() {
    Rectangle rect(10, 20);
    rect.display();
    
    // 链式调用
    rect.setWidth(15).setHeight(25);
    rect.display();
    
    return 0;
}
```

## 4. 静态成员

### 静态成员变量

```cpp
#include <iostream>
using namespace std;

class Counter {
private:
    static int count;  // 静态成员变量（类级别的变量）
    int id;
    
public:
    Counter() {
        id = ++count;  // 每创建一个对象，count自增
    }
    
    static int getCount() {  // 静态成员函数
        return count;
    }
    
    int getId() {
        return id;
    }
};

// 静态成员变量必须在类外定义
int Counter::count = 0;

int main() {
    cout << "初始计数: " << Counter::getCount() << endl;
    
    Counter c1, c2, c3;
    
    cout << "对象数量: " << Counter::getCount() << endl;
    cout << "c1的ID: " << c1.getId() << endl;
    cout << "c2的ID: " << c2.getId() << endl;
    cout << "c3的ID: " << c3.getId() << endl;
    
    return 0;
}
```

### 静态成员函数

```cpp
#include <iostream>
using namespace std;

class Math {
public:
    // 静态成员函数：不依赖对象，可以不用对象调用
    static double add(double a, double b) {
        return a + b;
    }
    
    static double multiply(double a, double b) {
        return a * b;
    }
    
    // 静态成员函数不能访问非静态成员
    // 但可以访问静态成员
    static int getVersion() {
        return 1;
    }
};

int main() {
    // 不需要创建对象就可以调用
    cout << Math::add(10, 20) << endl;
    cout << Math::multiply(3, 4) << endl;
    cout << "版本: " << Math::getVersion() << endl;
    
    return 0;
}
```

## 5. 友元

### 友元函数

```cpp
#include <iostream>
using namespace std;

class Rectangle {
private:
    int width, height;
    
    // 声明友元函数
    friend void display(Rectangle& r);
    friend bool isLarger(const Rectangle& r1, const Rectangle& r2);
    
public:
    Rectangle(int w, int h) : width(w), height(h) {}
    
    int area() {
        return width * height;
    }
};

// 友元函数定义：可以访问私有成员
void display(Rectangle& r) {
    cout << "宽度: " << r.width << ", 高度: " << r.height << endl;
}

bool isLarger(const Rectangle& r1, const Rectangle& r2) {
    return (r1.width * r1.height) > (r2.width * r2.height);
}

int main() {
    Rectangle rect1(10, 20);
    Rectangle rect2(15, 25);
    
    display(rect1);
    display(rect2);
    
    if (isLarger(rect1, rect2)) {
        cout << "rect1更大" << endl;
    } else {
        cout << "rect2更大" << endl;
    }
    
    return 0;
}
```

### 友元类

```cpp
#include <iostream>
using namespace std;

class Rectangle;

class RectangleHelper {
public:
    void modify(Rectangle& r, int w, int h);
};

class Rectangle {
private:
    int width, height;
    
    // 声明友元类
    friend class RectangleHelper;
    
public:
    Rectangle(int w, int h) : width(w), height(h) {}
    
    void display() {
        cout << "宽度: " << width << ", 高度: " << height << endl;
    }
};

// 友元类的成员函数可以访问Rectangle的私有成员
void RectangleHelper::modify(Rectangle& r, int w, int h) {
    r.width = w;
    r.height = h;
}

int main() {
    Rectangle rect(10, 20);
    rect.display();
    
    RectangleHelper helper;
    helper.modify(rect, 30, 40);
    rect.display();
    
    return 0;
}
```

## 6. 综合示例

### 完整的类设计

```cpp
#include <iostream>
#include <string>
#include <vector>
using namespace std;

class Book {
private:
    string title;
    string author;
    double price;
    static int totalBooks;
    
public:
    // 构造函数
    Book(string t, string a, double p) 
        : title(t), author(a), price(p) {
        totalBooks++;
    }
    
    // 拷贝构造函数
    Book(const Book& other) 
        : title(other.title), author(other.author), price(other.price) {
        totalBooks++;
    }
    
    // 析构函数
    ~Book() {
        totalBooks--;
    }
    
    // Getter方法
    string getTitle() const { return title; }
    string getAuthor() const { return author; }
    double getPrice() const { return price; }
    
    // Setter方法
    void setPrice(double p) {
        if (p > 0) {
            price = p;
        }
    }
    
    // 显示信息
    void display() const {
        cout << "书名: " << title << ", 作者: " << author 
             << ", 价格: " << price << endl;
    }
    
    // 静态方法
    static int getTotalBooks() {
        return totalBooks;
    }
};

// 静态成员变量定义
int Book::totalBooks = 0;

int main() {
    cout << "初始书籍数: " << Book::getTotalBooks() << endl;
    
    Book book1("C++入门", "张三", 59.9);
    Book book2("算法导论", "李四", 89.9);
    
    book1.display();
    book2.display();
    
    cout << "当前书籍数: " << Book::getTotalBooks() << endl;
    
    {
        Book book3(book1);
        cout << "复制后书籍数: " << Book::getTotalBooks() << endl;
    }  // book3离开作用域
    
    cout << "销毁后书籍数: " << Book::getTotalBooks() << endl;
    
    return 0;
}
```

## 练习

1. 设计一个Person类，包含姓名、年龄等属性，并实现相关的成员函数
2. 创建一个Circle类，包含半径属性，实现计算面积和周长的功能
3. 实现一个Date类，包含年月日，实现日期比较等功能
4. 创建一个BankAccount类，实现存款、取款、查询余额等功能
5. 设计一个Library类，管理Book对象集合

