# C++文件操作

本教程将学习C++中的文件操作，包括文件流、文本文件、二进制文件等。

## 1. 文件流基础

### 文件流类

```cpp
#include <iostream>
#include <fstream>
#include <string>
using namespace std;

int main() {
    // ofstream: 输出文件流（写文件）
    ofstream outfile("output.txt");
    if (outfile.is_open()) {
        outfile << "Hello, File!" << endl;
        outfile << 123 << " " << 3.14 << endl;
        outfile.close();
    }
    
    // ifstream: 输入文件流（读文件）
    ifstream infile("output.txt");
    if (infile.is_open()) {
        string line;
        while (getline(infile, line)) {
            cout << line << endl;
        }
        infile.close();
    }
    
    // fstream: 输入输出文件流
    fstream file("data.txt", ios::in | ios::out | ios::trunc);
    if (file.is_open()) {
        file << "Data" << endl;
        file.close();
    }
    
    return 0;
}
```

### 文件打开模式

```cpp
#include <fstream>
using namespace std;

void file_modes() {
    // ios::in: 读取模式
    ifstream ifs("file.txt", ios::in);
    
    // ios::out: 写入模式（覆盖）
    ofstream ofs("file.txt", ios::out);
    
    // ios::app: 追加模式
    ofstream appfile("file.txt", ios::app);
    
    // ios::ate: 打开后定位到文件末尾
    fstream file("file.txt", ios::in | ios::ate);
    
    // ios::trunc: 截断文件
    fstream file2("file.txt", ios::out | ios::trunc);
    
    // ios::binary: 二进制模式
    ofstream binfile("file.bin", ios::binary);
    
    // 组合模式
    fstream file3("file.txt", ios::in | ios::out | ios::app);
}
```

## 2. 文本文件读写

### 写入文本文件

```cpp
#include <iostream>
#include <fstream>
using namespace std;

void write_text_file() {
    ofstream outfile("students.txt");
    
    if (outfile.is_open()) {
        outfile << "姓名\t年龄\t分数" << endl;
        outfile << "张三\t20\t95" << endl;
        outfile << "李四\t21\t87" << endl;
        outfile << "王五\t19\t92" << endl;
        outfile.close();
        cout << "文件写入成功" << endl;
    } else {
        cerr << "无法打开文件" << endl;
    }
}
```

### 读取文本文件

```cpp
#include <iostream>
#include <fstream>
#include <string>
#include <sstream>
using namespace std;

void read_text_file() {
    ifstream infile("students.txt");
    
    if (infile.is_open()) {
        string line;
        while (getline(infile, line)) {
            cout << line << endl;
        }
        infile.close();
    }
}

// 读取CSV文件
void read_csv() {
    ifstream infile("data.csv");
    string line;
    
    while (getline(infile, line)) {
        stringstream ss(line);
        string token;
        
        while (getline(ss, token, ',')) {
            cout << token << "\t";
        }
        cout << endl;
    }
}
```

### 逐词读取

```cpp
#include <iostream>
#include <fstream>
#include <string>
using namespace std;

void read_word_by_word() {
    ifstream infile("text.txt");
    string word;
    
    while (infile >> word) {
        cout << word << " ";
    }
    cout << endl;
    infile.close();
}
```

## 3. 二进制文件

### 写入二进制文件

```cpp
#include <iostream>
#include <fstream>
using namespace std;

struct Student {
    int id;
    char name[50];
    double score;
};

void write_binary_file() {
    ofstream outfile("students.bin", ios::binary);
    
    if (outfile.is_open()) {
        Student students[] = {
            {1, "张三", 95.5},
            {2, "李四", 87.0},
            {3, "王五", 92.5}
        };
        
        // 写入数组
        outfile.write(reinterpret_cast<char*>(students), 
                     sizeof(students));
        
        // 或者逐个写入
        for (int i = 0; i < 3; i++) {
            outfile.write(reinterpret_cast<char*>(&students[i]),
                         sizeof(Student));
        }
        
        outfile.close();
    }
}
```

### 读取二进制文件

```cpp
#include <iostream>
#include <fstream>
using namespace std;

void read_binary_file() {
    ifstream infile("students.bin", ios::binary);
    
    if (infile.is_open()) {
        Student student;
        
        while (infile.read(reinterpret_cast<char*>(&student),
                          sizeof(Student))) {
            cout << "ID: " << student.id << endl;
            cout << "姓名: " << student.name << endl;
            cout << "分数: " << student.score << endl;
            cout << endl;
        }
        
        infile.close();
    }
}
```

## 4. 文件位置操作

```cpp
#include <iostream>
#include <fstream>
using namespace std;

void file_positioning() {
    fstream file("data.txt", ios::in | ios::out);
    
    if (file.is_open()) {
        // 写入数据
        file << "0123456789";
        
        // 获取当前位置
        streampos pos = file.tellg();
        cout << "当前位置: " << pos << endl;
        
        // 移动到文件开头
        file.seekg(0, ios::beg);
        
        // 移动到文件末尾
        file.seekg(0, ios::end);
        pos = file.tellg();
        cout << "文件大小: " << pos << " 字节" << endl;
        
        // 相对当前位置移动
        file.seekg(-5, ios::cur);
        
        // 从文件末尾移动
        file.seekg(-10, ios::end);
        
        file.close();
    }
}
```

## 5. 文件状态检查

```cpp
#include <iostream>
#include <fstream>
using namespace std;

void check_file_status() {
    ifstream infile("test.txt");
    
    if (!infile) {
        cerr << "文件打开失败" << endl;
        return;
    }
    
    // 检查文件状态
    if (infile.good()) {
        cout << "文件状态良好" << endl;
    }
    
    if (infile.eof()) {
        cout << "到达文件末尾" << endl;
    }
    
    if (infile.fail()) {
        cout << "操作失败" << endl;
    }
    
    if (infile.bad()) {
        cout << "文件损坏" << endl;
    }
    
    // 清除错误标志
    infile.clear();
    
    infile.close();
}
```

## 6. 字符串流

```cpp
#include <iostream>
#include <sstream>
#include <string>
using namespace std;

void string_stream_example() {
    // stringstream: 字符串流
    stringstream ss;
    
    // 写入字符串流
    ss << "Hello " << 123 << " " << 3.14;
    
    // 读取字符串流
    string str;
    int num;
    double d;
    
    ss >> str >> num >> d;
    cout << str << " " << num << " " << d << endl;
    
    // 获取字符串
    string content = ss.str();
    cout << content << endl;
    
    // ostringstream: 输出字符串流
    ostringstream oss;
    oss << "Result: " << 100;
    string result = oss.str();
    cout << result << endl;
    
    // istringstream: 输入字符串流
    istringstream iss("10 20 30");
    int a, b, c;
    iss >> a >> b >> c;
    cout << a << " " << b << " " << c << endl;
}
```

## 7. 综合示例

### 学生信息管理系统

```cpp
#include <iostream>
#include <fstream>
#include <vector>
#include <string>
#include <sstream>
using namespace std;

class Student {
public:
    int id;
    string name;
    int age;
    double score;
    
    Student(int i = 0, string n = "", int a = 0, double s = 0.0)
        : id(i), name(n), age(a), score(s) {}
    
    void display() const {
        cout << "ID: " << id << ", 姓名: " << name
             << ", 年龄: " << age << ", 分数: " << score << endl;
    }
};

class StudentManager {
private:
    vector<Student> students;
    string filename;
    
public:
    StudentManager(const string& file) : filename(file) {}
    
    void loadFromFile() {
        ifstream infile(filename);
        if (infile.is_open()) {
            students.clear();
            string line;
            while (getline(infile, line)) {
                if (!line.empty()) {
                    stringstream ss(line);
                    int id, age;
                    string name;
                    double score;
                    ss >> id >> name >> age >> score;
                    students.push_back(Student(id, name, age, score));
                }
            }
            infile.close();
        }
    }
    
    void saveToFile() {
        ofstream outfile(filename);
        if (outfile.is_open()) {
            for (const auto& student : students) {
                outfile << student.id << " " << student.name << " "
                       << student.age << " " << student.score << endl;
            }
            outfile.close();
        }
    }
    
    void addStudent(const Student& student) {
        students.push_back(student);
    }
    
    void displayAll() {
        for (const auto& student : students) {
            student.display();
        }
    }
};

int main() {
    StudentManager manager("students.txt");
    
    manager.loadFromFile();
    
    manager.addStudent(Student(1, "张三", 20, 95.5));
    manager.addStudent(Student(2, "李四", 21, 87.0));
    manager.addStudent(Student(3, "王五", 19, 92.5));
    
    manager.displayAll();
    manager.saveToFile();
    
    return 0;
}
```

## 练习

1. 编写一个程序，统计文本文件中单词的个数
2. 实现一个文件复制程序
3. 创建一个程序，读取CSV文件并显示数据
4. 实现一个简单的日志记录系统
5. 编写一个程序，将结构体数据保存到二进制文件并读取

